<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>LÜIS | Commission Price Calculator</title>
    
    <style>
        /* ================================================= */
        /* BASE STYLING & COLOR VARIABLES */
        /* ================================================= */
        :root {
            /* --- COLOR PALETTE (Requested: White Background + #d4ff79 & #8291e1) --- */
            --primary-accent: #d4ff79; /* Light Green - Buttons, Highlights */
            --secondary-accent: #8291e1; /* Light Blue/Violet - Text/Borders/Secondary Highlights */
            
            --bg-base: #fff; /* Main Page Background */
            --card-base: #fff; /* Card/Panel remains white */
            --text-dark: #000;
            --text-light: #fff;
            --text-gray: #4a4a4a;
            --gray-light: #f4f4f4; /* Light background for unselected options */

            --card-radius: 16px;
            --border-radius-lg: 50px;
            --spacing-lg: 80px;
            --spacing-md: 40px;
            
            --accent-text: #000; /* Black text on primary accent background (#d4ff79) */
            --shadow-soft: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        /* FONTS (Assuming font files are available in ./fonts/) */
        @font-face { font-family: 'Athletics'; font-style: normal; font-weight: 400; font-display: swap; src: url('./fonts/Athletics Regular.otf') format('opentype'); }
        @font-face { font-family: 'Athletics'; font-style: normal; font-weight: 500; font-display: swap; src: url('./fonts/Athletics Medium.otf') format('opentype'); }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            background: var(--bg-base); /* White Background */
            font-family: 'Athletics', Arial, sans-serif;
            color: var(--text-dark); 
            min-height: 100vh;
        }
        a { text-decoration: none; color: var(--text-dark); transition: color 0.3s ease; }

        /* NAVBAR STYLING - Adjusted for White Background */
        .navbar { 
            position: sticky; top: 30px; left: 0; width: 100%; display: flex; 
            justify-content: space-between; align-items: center; padding: 0 var(--spacing-md); z-index: 200; 
        }
        /* LOGO COLOR CHANGED TO BLACK */
        .luis-logo { font-size: 2.5rem; font-weight: 500; color: var(--text-dark); } 
        
        .glass-island { 
            display: flex; gap: 30px; padding: 15px 30px; border-radius: var(--border-radius-lg); 
            background: rgba(255, 255, 255, 0.7); /* Lighter glass effect */
            backdrop-filter: blur(10px) saturate(180%); -webkit-backdrop-filter: blur(10px) saturate(180%); 
            border: none; 
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); 
        }
        .glass-island a { color: var(--text-dark); text-decoration: none; font-weight: 400; font-size: 1.1rem; padding: 5px 0; }
        .hamburger-menu { width: 30px; height: 30px; display: flex; flex-direction: column; justify-content: space-around; cursor: pointer; padding: 5px 0; }
        .hamburger-menu span { display: block; width: 100%; height: 2px; background-color: var(--text-dark); } /* Black burger lines */
        
        /* CALCULATOR LAYOUT & CONTAINER */
        .request-container { max-width: 1000px; margin: 0 auto; padding: 80px var(--spacing-lg) var(--spacing-lg); }
        .right-panel { 
            width: 100%; padding: 40px; border-radius: 25px; 
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); /* Stronger shadow for floating effect on white BG */
            background: var(--card-base); 
            border: none; /* Removed border */
            display: flex; flex-direction: column;
        }
        
        /* ⭐️ MALAKING GREETING STYLE */
        .main-greeting {
            font-size: 4rem; 
            font-weight: 500; 
            text-align: center;
            margin-bottom: 50px;
            color: var(--secondary-accent);
            line-height: 1.1;
        }
        
        /* --- Calculator Specific Styles --- */
        .header { margin-bottom: var(--spacing-md); }
        .header h1 { font-size: 2.2rem; font-weight: 500; color: var(--text-dark); margin-bottom: 5px; }
        .header p { color: var(--text-gray); font-size: 1.1rem; }

        .step-container { 
            position: relative; min-height: 350px; flex-grow: 1; padding-bottom: var(--spacing-md); 
            overflow: hidden; /* Important for animation */
        }
        
        /* ⭐️ STEP ANIMATION STYLES (Slide-in/Slide-out) */
        .step { 
            position: absolute; width: 100%; top: 0; left: 0;
            visibility: hidden; 
            transition: transform 0.4s ease-in-out, opacity 0.4s ease-in-out;
            padding: var(--spacing-md) 0; 
        }
        
        /* Default state (Hidden, off-screen right) */
        .step:not(.active) {
            opacity: 0;
            transform: translateX(100%);
        }

        /* Active state (Visible, on-screen center) */
        .step.active { 
            opacity: 1; 
            visibility: visible; 
            position: relative; /* Only active element takes up space */
            transform: translateX(0);
        }
        
        /* Animation class for slide-out left (used when going NEXT) */
        .step.slide-out-left {
            transform: translateX(-100%);
            opacity: 0;
            visibility: hidden;
        }
        
        /* New class for slide-out right (used when going PREVIOUS) */
        .step.slide-out-right {
            transform: translateX(100%);
            opacity: 0;
            visibility: hidden;
        }

        /* Override default for 'prev' transition, starting off-screen left */
        .step.slide-in-from-left {
            transform: translateX(-100%);
            opacity: 0;
            visibility: hidden;
        }
        
        /* Final state for a previous step coming in */
        .step.slide-in-from-left.active {
             transform: translateX(0);
             opacity: 1;
             visibility: visible;
        }

        .step h3 { font-size: 1.5rem; font-weight: 500; margin-bottom: var(--spacing-md); }
        
        /* Choice Options - PILL STYLE */
        .options-grid { display: flex; flex-wrap: wrap; gap: 12px; }
        .choice-option {
            background-color: var(--card-base); 
            border: 2px solid var(--text-gray); /* Pinalitan ng gray/default border */
            padding: 12px 20px;
            border-radius: 50px; /* Pill shape */
            cursor: pointer; transition: all 0.2s ease; font-size: 1rem;
            font-weight: 400; user-select: none;
            color: var(--text-dark);
        }
        .choice-option:hover { background-color: var(--gray-light); } /* Slight hover effect */
        .choice-option.selected {
            background-color: var(--primary-accent); 
            color: var(--accent-text); 
            border-color: var(--primary-accent); /* Green border kapag selected */
            font-weight: 500;
        }

        /* Dropdown/Select Styling */
        .styled-select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 20px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23333333'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 12px;
            cursor: pointer;
        }
        /* INALIS ANG FOCUS BORDER COLOR */
        .styled-select:focus { outline: none; border-color: #333; } 
        .input-group label { display: block; margin-bottom: 8px; font-weight: 500; }


        /* Navigation & Price Display */
        .navigation { 
            display: flex; justify-content: space-between; margin-top: auto; 
            padding-top: var(--spacing-md); border-top: 1px solid var(--gray-light); width: 100%; 
        }
        
        /* ⭐️ NAVIGATION BUTTON STYLE (Minimalist Black/White) */
        .nav-button {
            background-color: var(--card-base); 
            color: var(--text-dark); 
            border: 2px solid var(--text-dark); /* Black border */
            padding: 12px 25px; border-radius: 50px; cursor: pointer;
            font-size: 1rem; font-weight: 500; transition: all 0.2s;
        }
        .nav-button:hover { 
            background-color: var(--text-dark); 
            color: var(--text-light);
        } 
        .nav-button:disabled { 
            background-color: #ccc; 
            border-color: #ccc; 
            cursor: not-allowed; 
            color: #555; 
        }

        .total-price-display { text-align: center; padding: 30px 0; }
        #final-price-value {
            font-size: 3rem; font-weight: 500; color: var(--secondary-accent); /* Use secondary accent for total price */
            display: block; margin-bottom: 20px;
        }
        
        /* Input Styles */
        .form-input {
            width: 100%; border: 1px solid #ccc; padding: 15px; font-size: 1rem;
            font-family: 'Athletics', sans-serif; margin-bottom: 20px; resize: vertical;
            border-radius: 8px; transition: border-color 0.3s;
        }
        /* INALIS ANG FOCUS BORDER COLOR */
        .form-input:focus { outline: none; border-color: #333; } 
        
        .file-upload-wrapper {
            border: 1px dashed var(--text-dark); /* Pinalitan ng itim na dashed border */
            padding: 15px; border-radius: 8px; margin-bottom: 20px;
            text-align: center; cursor: pointer;
        }
        .file-upload-wrapper:hover { border-color: var(--primary-accent); } /* Primary accent on hover */

        /* RECEIPT ANIMATION STYLING */
        @keyframes printAnimation {
            0% { transform: translateY(100%); opacity: 0; }
            50% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(0); opacity: 1; }
        }
        
        .receipt-area {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 50px 0; text-align: center;
        }

        .receipt-loading {
            font-size: 1.5rem; font-weight: 500; color: var(--secondary-accent); 
            animation: pulse 1.5s infinite; margin-bottom: 30px;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .final-receipt-paper {
            background: var(--card-base); 
            border: 1px solid #eee; 
            border-radius: 8px;
            width: 100%; 
            max-width: 400px;
            padding: 30px; 
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            transform: translateY(100%); 
            opacity: 0;
            animation: printAnimation 1.5s ease-out forwards;
        }
        .receipt-header {
            font-size: 1.5rem; font-weight: 500; border-bottom: 2px dashed #ccc;
            padding-bottom: 10px; margin-bottom: 15px;
        }
        .receipt-item { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 1rem; }
        .receipt-item-title { font-weight: 400; color: #555; }
        .receipt-total { border-top: 2px solid var(--text-dark); margin-top: 15px; padding-top: 10px; font-size: 1.4rem; font-weight: 500; }
        .receipt-note-box { background: var(--gray-light); padding: 10px; border-radius: 5px; margin-top: 15px; font-size: 0.9rem; text-align: left; }

        /* Style for the Instructions Box (English/Card Style - Font Fixed) */
        .contact-instruction-card {
            background-color: var(--card-base); 
            padding: 20px;
            border-radius: 16px; 
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08); 
            max-width: 400px;
            width: 100%;
            text-align: left;
            margin-top: 30px; 
            display: none; 
            /* FIXED FONT: Use the calculator's primary font */
            font-family: 'Athletics', Arial, sans-serif; 
        }

        .contact-instruction-card .heading {
            font-size: 1.1rem;
            color: #333;
            margin-bottom: 15px;
            font-weight: 500; /* Adjusted for Athletics font */
        }
        
        .contact-instruction-card .message {
            font-size: 1.2rem; 
            color: #000;
            line-height: 1.4;
            font-weight: 500;
            margin-bottom: 15px;
        }

        .contact-instruction-card .links-area {
            border-top: 1px solid var(--gray-light);
            padding-top: 10px;
        }

        .contact-instruction-card a {
            color: var(--secondary-accent);
            text-decoration: underline;
            font-weight: 500;
            display: block; 
            margin-top: 5px;
            font-size: 0.95rem;
        }


        /* Responsive Design */
        @media (max-width: 900px) {
            :root { --spacing-lg: 30px; --spacing-md: 20px; }
            .navbar { padding: 20px var(--spacing-md); }
            .request-container { padding: 20px var(--spacing-lg) 40px; }
            .right-panel { padding: 20px; }
            .navigation { flex-direction: column; gap: 10px; }
            .nav-button { width: 100%; text-align: center; }
            .receipt-area { padding: 20px 0; }
            .main-greeting { font-size: 2.5rem; margin-bottom: 30px; }
        }
    </style>
</head>
<body>

    <header class="navbar">
        <div class="luis-logo">LÜIS</div>
        <nav class="glass-island">
            <a href="index.html">Home</a> 
            <a href="portfolio.html">Portfolio</a> 
            <a href="request.html">Request</a> 
            <a href="#footer">Contact</a> 
        </nav>
        <div class="hamburger-menu" id="hamburger-open">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </header>

    <div class="request-container">
        
        <h2 class="main-greeting">Make It Yours</h2>

        <div class="right-panel">
            
            <div class="header">
                <h1>Commission Calculator</h1>
                <p>Find out how much your custom artwork will cost before ordering.</p>
            </div>
        
            <form id="price-calculator-form" onsubmit="event.preventDefault(); showStep(getNextStep(currentStep, selections.medium), 'next');">
                <div class="step-container">
                    
                    <div class="step active" data-step="1">
                        <h3>1. Choose Medium</h3>
                        <div class="options-grid">
                            <div class="choice-option" data-type="medium" data-value="Digital">Digital Art (Graphic Design)</div>
                            <div class="choice-option" data-type="medium" data-value="Traditional">Traditional Art (Drawing)</div>
                        </div>
                    </div>

                    <div class="step" data-step="2">
                        <h3>2. Paper Size (Acid-Free Paper)</h3>
                        <div class="options-grid">
                            <div class="choice-option" data-type="paper_size" data-value="A5" data-price="0">A5 (Standard, No additional cost)</div>
                            <div class="choice-option" data-type="paper_size" data-value="A3" data-price="50">A3 (+₱50)</div>
                        </div>
                    </div>

                    <div class="step" data-step="3">
                        <h3>3. Digital Art Type (Brutalist)</h3>
                        <p style="margin-bottom: 20px; color: var(--text-gray);">Delivery via Google Drive. Pure Graphic Design/Vector.</p>
                        <div class="options-grid">
                            <div class="choice-option" data-type="digital_type" data-value="Poster" data-price="3000">Poster (₱3,000)</div>
                            <div class="choice-option" data-type="digital_type" data-value="Logo" data-price="1000">Logo (₱1,000)</div>
                        </div>
                    </div>
        
                    <div class="step" data-step="4">
                        <h3>4. Art Style (Select an Art Style)</h3>
                        <div class="options-grid">
                            <div class="choice-option" data-type="style" data-value="Realistic" data-price="1000">Realistic (+₱1,000)</div>
                            <div class="choice-option" data-type="style" data-value="Anime" data-price="200">Anime (+₱200)</div>
                            <div class="choice-option" data-type="style" data-value="Cartoon" data-price="200">Cartoon (+₱200)</div>
                            <div class="choice-option" data-type="style" data-value="Chibi" data-price="150">Chibi (+₱150)</div>
                        </div>
                    </div>
        
                    <div class="step" data-step="5">
                        <h3>5. Composition (Body Shot)</h3>
                        <div class="options-grid" id="composition-options">
                            <div class="choice-option" data-type="comp" data-value="Headshot">Headshot (Free)</div>
                            <div class="choice-option" data-type="comp" data-value="Bust">Bust (+Price Varies)</div>
                            <div class="choice-option" data-type="comp" data-value="Half Body">Half Body (+Price Varies)</div>
                            <div class="choice-option" data-type="comp" data-value="Full Body">Full Body (+Price Varies)</div>
                        </div>
                    </div>
        
                    <div class="step" data-step="6">
                        <h3>6. Finish</h3>
                        <div class="options-grid">
                            <div class="choice-option" data-type="finish" data-value="Lineart" data-price="0">Lineart (Free)</div>
                            <div class="choice-option" data-type="finish" data-value="Shaded" data-price="50">Shaded (+₱50)</div>
                            <div class="choice-option" data-type="finish" data-value="Colored" data-price="100">Colored (+₱100)</div>
                        </div>
                    </div>
                    
                    <div class="step" data-step="7">
                        <h3>7. Background</h3>
                        <div class="options-grid">
                            <div class="choice-option" data-type="bg" data-value="None" data-price="0">No Background / Solid (Free)</div>
                            <div class="choice-option" data-type="bg" data-value="Simple" data-price="150">Simple (+₱150)</div>
                            <div class="choice-option" data-type="bg" data-value="Detailed">Detailed (+₱250 to ₱450)</div>
                        </div>
                        
                        <div id="bg-slider-group" class="input-group" style="display:none; margin-top: 20px;">
                            <label for="bg-slider">Choose Detailed BG Price:</label>
                            <input type="range" id="bg-slider" min="250" max="450" step="50" value="250">
                            <div style="text-align: center; font-weight: 500;">Current Cost: ₱<span id="bg-slider-value">250</span></div>
                        </div>
                    </div>
        
                    <div class="step" data-step="8">
                        <h3>8. Extras</h3>
                        
                        <div class="input-group" style="margin-bottom: 20px;">
                            <label for="extra-char-select">Extra Character(s) Composition (Base Price Varies)</label>
                            <select id="extra-char-select" class="styled-select" data-type="extra_char_comp">
                                <option value="0" selected>0 (No Extra Character)</option>
                                <option value="Headshot_1">1 Extra Character (Headshot)</option>
                                <option value="Bust_1">1 Extra Character (Bust)</option>
                                <option value="Half Body_1">1 Extra Character (Half Body)</option>
                                <option value="Full Body_1">1 Extra Character (Full Body)</option>
                                <option value="Headshot_2">2 Extra Characters (Headshot)</option>
                                <option value="Bust_2">2 Extra Characters (Bust)</option>
                                <option value="Half Body_2">2 Extra Characters (Half Body)</option>
                                <option value="Full Body_2">2 Extra Characters (Full Body)</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label>Pet / Object (+₱100 to ₱200)</label>
                            <div class="options-grid">
                                <div class="choice-option" data-type="extra_pet" data-value="Pet_Object_Base" data-price="100">Yes, with Pet/Object (+₱100)</div>
                            </div>
                            <div id="pet-slider-group" class="input-group" style="display:none; margin-top: 20px;">
                                <label for="pet-slider">Choose Pet/Object Price (Complexity):</label>
                                <input type="range" id="pet-slider" min="100" max="200" step="25" value="100">
                                <div style="text-align: center; font-weight: 500;">Current Cost: ₱<span id="pet-slider-value">100</span></div>
                            </div>
                        </div>
                    </div>

                    <div class="step" data-step="9">
                        <h3>9. Final Details & Payment</h3>
                        
                        <div class="total-price-display">
                            <span style="font-size: 1.2rem; display: block;">Current Estimated Price:</span>
                            <strong id="final-price-value">₱0</strong>
                        </div>
                        
                        <label style="font-weight: 500;">Mode of Payment</label>
                        <div class="options-grid" style="margin-bottom: 20px;">
                            <div class="choice-option" data-type="payment" data-value="GCash">GCash (Local)</div>
                            <div class="choice-option" data-type="payment" data-value="PayPal">PayPal (International, +transaction fee)</div>
                        </div>
                        
                        <label style="font-weight: 500;">Reference Image Upload (Optional)</label>
                        <div class="file-upload-wrapper">
                            <input type="file" id="reference-upload" class="form-input" style="display: none;" accept="image/*, .zip, .rar">
                            <p id="upload-label">Click here to upload reference file</p>
                        </div>
                        
                        <label for="notes" style="font-weight: 500;">Notes / Description (Optional)</label>
                        <textarea id="notes" class="form-input" placeholder="Please describe your character, pose, color details, and any other notes." rows="5"></textarea>
                    </div>

                    <div class="step" data-step="10">
                        <h3>Commission Confirmation</h3>
                        <div class="receipt-area">
                            <div class="receipt-loading">Preparing your summary...</div>
                            <div class="final-receipt-paper" id="final-receipt-content" style="display: none;">
                            </div>
                            
                            <button type="button" id="copy-details-btn" class="nav-button" style="display: none; margin-top: 20px; background-color: var(--primary-accent); border-color: var(--primary-accent); color: var(--accent-text);">
                                COPY DETAILS
                            </button>

                            <div id="contact-instruction-card" class="contact-instruction-card">
                                <div class="heading">
                                    Your Contact Person:
                                </div>
                                <div class="message">
                                    The Kai Collection will contact you shortly after receiving your order details. See you then.
                                </div>
                                
                                <div class="links-area">
                                    <p style="font-weight: 500; margin-bottom: 5px;">Send the copied details to:</p>
                                    <a href="https://www.facebook.com/profile.php?id=61581185863360" target="_blank">
                                        The Kai Collection (Facebook)
                                    </a>
                                    <a href="https://www.tiktok.com/@kai_random00" target="_blank">
                                        @kai_random00 (TikTok)
                                    </a>
                                </div>
                            </div>

                        </div>
                    </div>
                    
                </div>
                
                <div class="navigation">
                    <button type="button" id="prev-btn" class="nav-button" disabled>← Previous</button>
                    <button type="submit" id="next-btn" class="nav-button">Next →</button>
                </div>
                
            </form>

        </div>
        
    </div>
    
    <script>
    // Price rules for non-composition items (Style, Finish, Extras Base)
    const priceRules = {
        'Traditional_Base': 0, 
        'Realistic': 1000, 'Anime': 200, 'Cartoon': 200, 'Chibi': 150,
        'A3_ADDON': 50, 
        
        // Extra Character Base Price 
        'Extra_Base': 150, 
        
        // Finish Prices
        'Colored': 100, 'Shaded': 50,

        // Digital Art Rules
        'Poster': 3000, 'Logo': 1000 
    };
    
    let selections = {
        medium: null, 
        paper_size: null, 
        digital_type: null, 
        // Traditional Art Selections
        style: null, comp: 'Headshot', finish: 'Lineart', bg: 'None', 
        bg_detailed_price: 250, 
        // Extra Character changed to dropdown value
        extra_char_type_count: '0', 
        pet_object: false, pet_object_price: 100,
        // Final Steps
        payment: null, notes: '', referenceFile: null
    };
    
    const totalSteps = 10; 
    let currentStep = 1;

    // DOM Elements
    const steps = document.querySelectorAll('.step');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const allOptions = document.querySelectorAll('.choice-option');
    const bgSliderGroup = document.getElementById('bg-slider-group');
    const bgSlider = document.getElementById('bg-slider');
    const bgSliderValue = document.getElementById('bg-slider-value');
    const petSliderGroup = document.getElementById('pet-slider-group');
    const petSlider = document.getElementById('pet-slider');
    const petSliderValue = document.getElementById('pet-slider-value');
    const referenceUpload = document.getElementById('reference-upload');
    const uploadLabel = document.getElementById('upload-label');
    const notesInput = document.getElementById('notes');
    const receiptLoading = document.querySelector('.receipt-loading');
    const finalReceiptPaper = document.getElementById('final-receipt-content');
    const finalPriceDisplay = document.getElementById('final-price-value');
    const extraCharSelect = document.getElementById('extra-char-select');
    // Renamed button
    const copyDetailsBtn = document.getElementById('copy-details-btn'); 
    // NEW ELEMENT: Instruction Box
    const contactInstructionCard = document.getElementById('contact-instruction-card');


    // --- Core Calculation Functions ---
    
    function getTraditionalBasePrice() {
        return priceRules['Traditional_Base'];
    }

    function getPriceForComposition(comp, isRealistic) {
        if (comp === 'Headshot') return 0;
        if (comp === 'Bust') return isRealistic ? 300 : 200;
        if (comp === 'Half Body') return isRealistic ? 400 : 300; 
        if (comp === 'Full Body') return isRealistic ? 600 : 450; 
        return 0; // fallback
    }

    function calculateExtraCharPrice() {
        if (selections.extra_char_type_count === '0') return 0;

        const parts = selections.extra_char_type_count.split('_');
        const compType = parts[0]; 
        const count = parseInt(parts[1]); 
        
        const isRealistic = (selections.style === 'Realistic');
        
        // Composition Add-on price (Bust, Half, Full)
        const compAddOn = getPriceForComposition(compType, isRealistic);
        
        const basePrice = priceRules['Extra_Base'];
        // Price = Count * (Base Price + Composition Add-on)
        return count * (basePrice + compAddOn); 
    }

    function calculateItemizedPrices() {
        const items = [];
        let total = 0;

        if (selections.medium === 'Digital') {
            const type = selections.digital_type;
            if (type && priceRules[type]) {
                const price = priceRules[type];
                items.push({ name: `Digital Art: ${type} (Brutalist)`, price: price });
                total += price;
            }
        } else if (selections.medium === 'Traditional') {
            // 1. Base Price 
            const basePrice = getTraditionalBasePrice();
            items.push({ name: 'Traditional Art Base', price: basePrice });
            total += basePrice;
            
            const styleType = selections.style;
            const isRealistic = (styleType === 'Realistic');

            // 2. Paper Size Add-on
            const paperSize = selections.paper_size;
            if (paperSize === 'A3') {
                const price = priceRules['A3_ADDON'];
                items.push({ name: `Paper Size: A3`, price: price });
                total += price;
            } else if (paperSize === 'A5') {
                items.push({ name: `Paper Size: A5 (Standard)`, price: 0 });
            }
            
            // 3. Style Add-on
            if (styleType && priceRules[styleType]) {
                const price = priceRules[styleType];
                items.push({ name: `Style: ${styleType}`, price: price });
                total += price;
            }

            // 4. Composition Price (Main Character) - USES NEW FUNCTION
            if (selections.style) { 
                const compPrice = getPriceForComposition(selections.comp, isRealistic);
                items.push({ name: `Main Composition: ${selections.comp}`, price: compPrice });
                total += compPrice;
            }
            
            // 5. Finish Price
            let finishPrice = 0;
            let finishName = selections.finish;
            if (selections.finish === 'Colored') finishPrice = priceRules['Colored'];
            else if (selections.finish === 'Shaded') finishPrice = priceRules['Shaded'];
            items.push({ name: `Finish: ${finishName}`, price: finishPrice });
            total += finishPrice;

            // 6. Background Price
            let bgPrice = 0;
            let bgName = selections.bg;
            if (selections.bg === 'Simple') bgPrice = 150;
            else if (selections.bg === 'Detailed') bgPrice = selections.bg_detailed_price;
            items.push({ name: `Background: ${bgName}`, price: bgPrice });
            total += bgPrice;

            // 7. Extra Character Price 
            const extraCharPrice = calculateExtraCharPrice(); 
            if (extraCharPrice > 0) {
                const parts = selections.extra_char_type_count.split('_');
                const compType = parts[0];
                const count = parts[1];
                items.push({ name: `Extra Character(s) x${count} (${compType} + Base)`, price: extraCharPrice });
                total += extraCharPrice;
            }
            
            // 8. Pet/Object Price
            if (selections.pet_object) {
                items.push({ name: 'Pet / Object', price: selections.pet_object_price });
                total += selections.pet_object_price;
            }
        }

        return { items, total };
    }
    
    function calculateTotalPrice() {
        return calculateItemizedPrices().total;
    }
    
    function updateTotalPriceDisplay() {
        const totalPrice = calculateTotalPrice();
        finalPriceDisplay.textContent = `₱${totalPrice.toLocaleString()}`;
    }
    
    // Updates the labels for composition options based on Style selection
    function updateCompositionPrices() {
        if (selections.medium !== 'Traditional' || selections.style === null) {
            document.querySelectorAll('#composition-options .choice-option').forEach(opt => {
                const compType = opt.dataset.value;
                if (compType === 'Headshot') opt.textContent = 'Headshot (Free)';
                else opt.textContent = `${compType} (+Price Varies)`;
            });
            return;
        }

        const isRealistic = (selections.style === 'Realistic');
        document.querySelectorAll('#composition-options .choice-option').forEach(opt => {
            const compType = opt.dataset.value;
            const price = getPriceForComposition(compType, isRealistic);
            if (price > 0) {
                opt.textContent = `${compType} (+₱${price.toLocaleString()})`;
            } else {
                opt.textContent = `${compType} (Free)`;
            }
        });
    }
    
    // Updates the extra character dropdown labels
    function updateExtraCharSelectPrices() {
        if (selections.medium !== 'Traditional' || selections.style === null) return;
        
        const isRealistic = (selections.style === 'Realistic');
        const select = extraCharSelect;
        const extra_base = priceRules['Extra_Base'];
        
        const compPrices = {
            'Headshot': getPriceForComposition('Headshot', isRealistic),
            'Bust': getPriceForComposition('Bust', isRealistic),
            'Half Body': getPriceForComposition('Half Body', isRealistic),
            'Full Body': getPriceForComposition('Full Body', isRealistic)
        };
        
        for (let i = 1; i < select.options.length; i++) {
            const option = select.options[i];
            const parts = option.value.split('_');
            const compType = parts[0];
            const count = parseInt(parts[1]);
            
            const totalPerChar = compPrices[compType] + extra_base;
            const totalPrice = count * totalPerChar;
            
            option.textContent = `${count} Extra Character (${compType} Total: ₱${totalPrice.toLocaleString()})`;
        }
    }

    // --- Receipt HTML Generation (For Display Only) ---

    function generateReceiptHTML(items, total, paymentMethod, notes, referenceFile) {
        let itemsHtml = items.map(item => `
            <div class="receipt-item">
                <span class="receipt-item-title">${item.name}</span>
                <span class="receipt-item-price">₱${item.price.toLocaleString()}</span>
            </div>
        `).join('');

        // Handle PayPal Fee
        let finalTotal = total;
        let paypalFeeHtml = '';
        if (paymentMethod === 'PayPal') {
            // Approx 5% approximation for calculator
            const fee = Math.round(total * 0.05); 
            finalTotal += fee;
            paypalFeeHtml = `
                <div class="receipt-item" style="color: red;">
                    <span class="receipt-item-title">PayPal Transaction Fee (est. 5%)</span>
                    <span class="receipt-item-price">+₱${fee.toLocaleString()}</span>
                </div>
            `;
        }

        // Add Notes and Reference Info
        let noteBoxHtml = '';
        if (notes || referenceFile) {
            noteBoxHtml = '<div class="receipt-note-box">';
            if (notes) {
                // Truncate long notes for receipt display
                noteBoxHtml += `<strong>Notes:</strong> ${notes.substring(0, 150)} ${notes.length > 150 ? '...' : ''}`;
            }
            if (referenceFile) {
                noteBoxHtml += `<br><strong>Reference:</strong> ${referenceFile.name} attached.`;
            }
            noteBoxHtml += '</div>';
        }

        return `
            <div class="receipt-header">Commission Summary</div>
            ${itemsHtml}
            ${paypalFeeHtml}
            <div class="receipt-total">
                <div class="receipt-item">
                    <span>FINAL ESTIMATED PRICE:</span>
                    <strong style="color: var(--secondary-accent);">₱${finalTotal.toLocaleString()}</strong>
                </div>
            </div>
            <p style="margin-top: 10px; font-size: 0.9rem;">Payment Method: <strong>${paymentMethod || 'Not Selected'}</strong></p>
            ${noteBoxHtml}
            <p style="margin-top: 20px; font-size: 0.8rem; color: #777;">Click the COPY DETAILS button below to copy the summary. Do not forget to send the details and the reference file to The Kai Collection.</p>
        `;
    }

    // --- COPY TO CLIPBOARD FUNCTIONALITY ---

    function generateCopyText(items, total, paymentMethod, notes, referenceFile) {
        let receiptText = '--- COMMISSION REQUEST DETAILS (from LUIS Calculator) ---\n\n';
        
        let finalTotal = total;
        
        receiptText += '1. Commission Selections:\n';
        items.forEach(item => {
            receiptText += `- ${item.name}: ₱${item.price.toLocaleString()}\n`;
        });

        let paypalFee = 0;
        if (paymentMethod === 'PayPal') {
            paypalFee = Math.round(total * 0.05); 
            finalTotal += paypalFee;
            receiptText += `- PayPal Transaction Fee (est. 5%): +₱${paypalFee.toLocaleString()}\n`;
        }

        receiptText += `\n2. FINAL ESTIMATED PRICE: ₱${finalTotal.toLocaleString()}\n`;
        receiptText += `\n3. PAYMENT METHOD: ${paymentMethod || 'Not Selected'}\n`;
        
        if (notes.trim()) {
            receiptText += `\n4. NOTES / DESCRIPTION:\n${notes.trim()}\n`;
        } else {
            receiptText += `\n4. NOTES / DESCRIPTION: (None provided)\n`;
        }
        
        if (referenceFile) {
            receiptText += `\n5. REFERENCE FILE: ${referenceFile.name} (Please send this file directly to The Kai Collection)\n`;
        }
        
        receiptText += '\n--- END OF DETAILS ---\n\n';
        
        // Add Contact Instructions to the copied text (for completeness)
        receiptText += '*** CONTACT INSTRUCTIONS ***\n';
        receiptText += 'The Kai Collection will contact you shortly after receiving your order details. Send your details here:\n';
        receiptText += 'Facebook: https://www.facebook.com/profile.php?id=61581185863360\n';
        receiptText += 'TikTok: https://www.tiktok.com/@kai_random00';
        
        return receiptText;
    }

    function copyDetailsAndShowInstructions() {
        const { items, total } = calculateItemizedPrices();
        const copyText = generateCopyText(
            items, 
            total, 
            selections.payment, 
            notesInput.value, 
            selections.referenceFile
        );

        // Copy text to clipboard
        navigator.clipboard.writeText(copyText).then(() => {
            // Success: Change button text temporarily and show instructions box
            // REMOVED EMOJI FROM SUCCESS MESSAGE
            copyDetailsBtn.textContent = 'COPIED TO CLIPBOARD!'; 
            copyDetailsBtn.disabled = true;
            contactInstructionCard.style.display = 'block';

            // Reset button text after 3 seconds
            setTimeout(() => {
                copyDetailsBtn.textContent = 'COPY DETAILS'; // Reset without emoji
                copyDetailsBtn.disabled = false;
            }, 3000);

        }).catch(err => {
            // Fallback for failed copy (e.g., non-secure context)
            alert("COPY FAILED. Please manually copy all details from the screen and send them. Thank you!");
            contactInstructionCard.style.display = 'none'; // Ensure instructions are hidden if copy failed
        });
    }

    // --- Step Navigation Functions ---

    function getNextStep(current, medium) {
        if (current === 1 && medium === 'Digital') return 3;
        if (current === 1 && medium === 'Traditional') return 2;
        
        // Traditional path: 1 -> 2 -> 4 -> 5 -> 6 -> 7 -> 8 -> 9 -> 10
        if (current === 2 && medium === 'Traditional') return 4;
        
        // Digital path: 1 -> 3 -> 9 -> 10
        if (current === 3 && medium === 'Digital') return 9;

        // Default path (Traditional or continuing after step 4)
        return current + 1;
    }

    function getPreviousStep(current, medium) {
        if (current === 9 && medium === 'Digital') return 3;
        if (current === 4 && medium === 'Traditional') return 2;
        if (current === 3 && medium === 'Digital') return 1;
        if (current === 2 && medium === 'Traditional') return 1;

        // Default path
        return current - 1;
    }

    function checkStepValidity(stepIndex) {
        const stepElement = document.querySelector(`.step[data-step="${stepIndex}"]`);
        if (!stepElement) return true; 

        if (stepIndex === 1 && selections.medium === null) return false;
        
        if (selections.medium === 'Traditional') {
            if (stepIndex === 2 && selections.paper_size === null) return false;
            if (stepIndex === 4 && selections.style === null) return false;
            if (stepIndex === 5 && selections.comp === null) return false;
            if (stepIndex === 6 && selections.finish === null) return false;
            if (stepIndex === 7 && selections.bg === null) return false;
        }

        if (selections.medium === 'Digital') {
            if (stepIndex === 3 && selections.digital_type === null) return false;
        }

        // Enforce payment selection on step 9 for submission readiness
        if (stepIndex === 9 && selections.payment === null) return false;
        
        return true;
    }

    function showStep(stepIndex, direction = 'next') {
        const targetStepElement = document.querySelector(`.step[data-step="${stepIndex}"]`);
        const currentStepElement = document.querySelector(`.step.active`);
        if (!targetStepElement || !currentStepElement) return;

        // 1. Prepare the CURRENT step for transition (out)
        currentStepElement.classList.remove('active');
        currentStepElement.classList.remove('slide-in-from-left');

        if (direction === 'next') {
            currentStepElement.classList.remove('slide-out-right'); 
            currentStepElement.classList.add('slide-out-left');
        } else if (direction === 'prev') {
            currentStepElement.classList.remove('slide-out-left'); 
            currentStepElement.classList.add('slide-out-right');
        }

        // 2. Prepare the TARGET step for transition (in)
        targetStepElement.classList.remove('slide-out-left', 'slide-out-right');
        
        if (direction === 'prev') {
             // Set up position for slide-in from left: Start off-screen left
            targetStepElement.classList.add('slide-in-from-left');
        } else {
             // Reset to default (off-screen right) for slide-in from right
             targetStepElement.classList.remove('slide-in-from-left');
        }
        
        // Force reflow/re-render before setting active to ensure transition starts from correct position
        void targetStepElement.offsetWidth;

        // 3. Start the transition (set target to active)
        targetStepElement.classList.add('active');
        
        // Timeout to finalize state and update UI after CSS transition starts
        setTimeout(() => {
            currentStep = stepIndex;
            
            // Clean up: Reset position of steps that are not active, and remove temp animation classes
            steps.forEach(step => {
                if (step !== targetStepElement) {
                    step.classList.remove('slide-out-left', 'slide-out-right', 'slide-in-from-left');
                    step.style.transform = ''; 
                }
            });
            
            // Update UI/State for the new step
            updateNavigation();

            // Special logic for Step 9 (Final Details) and 10 (Receipt)
            if (currentStep === 9) {
                updateTotalPriceDisplay();
                nextBtn.textContent = 'Confirm & View Summary →';
            } else if (currentStep === 10) {
                nextBtn.textContent = 'Summary Complete';
                
                // Generate and display receipt
                const { items, total } = calculateItemizedPrices();
                finalReceiptPaper.innerHTML = generateReceiptHTML(
                    items, 
                    total, 
                    selections.payment, 
                    notesInput.value, 
                    selections.referenceFile
                );
                
                // Animate receipt and show copy button
                receiptLoading.style.display = 'block';
                finalReceiptPaper.style.display = 'none';
                copyDetailsBtn.style.display = 'none'; 
                contactInstructionCard.style.display = 'none'; // Ensure instructions are hidden on entry

                setTimeout(() => {
                    receiptLoading.style.display = 'none';
                    finalReceiptPaper.style.display = 'block';
                    // SHOW COPY BUTTON 
                    copyDetailsBtn.style.display = 'inline-block'; 
                }, 1000); 

            } else {
                nextBtn.textContent = 'Next →';
                copyDetailsBtn.style.display = 'none'; // Ensure hidden on other steps
                contactInstructionCard.style.display = 'none'; // Ensure hidden on other steps
            }
        }, 0); 
    }


    function updateNavigation() {
        // Update Previous Button
        const prevStep = getPreviousStep(currentStep, selections.medium);
        prevBtn.disabled = (prevStep < 1 || currentStep === 1 || currentStep === 10);
        
        // Update Next Button (Enable/Disable based on selection completion)
        const isCurrentStepValid = checkStepValidity(currentStep);
        if (currentStep !== 10) {
            nextBtn.disabled = !isCurrentStepValid;
        } else {
            nextBtn.disabled = true; // Final step is a dead end
        }
        
        // Special button text for the final confirmation button
        if (currentStep === 9) {
             nextBtn.textContent = 'Confirm & View Summary →';
        } else if (currentStep === 10) {
            nextBtn.textContent = 'Summary Complete';
        }
    }


    // --- Event Handlers ---

    // Handles all standard choice pill clicks
    allOptions.forEach(option => {
        option.addEventListener('click', function() {
            const type = this.dataset.type;
            const value = this.dataset.value;
            const price = parseFloat(this.dataset.price || 0);

            // Deselect all others of the same type
            document.querySelectorAll(`.choice-option[data-type="${type}"]`).forEach(opt => {
                opt.classList.remove('selected');
            });

            // Select current option
            this.classList.add('selected');
            
            // Update selections object
            selections[type] = value;
            
            // Handle special logic based on selection type
            if (type === 'medium') {
                 // Reset dependent traditional/digital selections when medium changes
                selections.paper_size = null;
                selections.digital_type = null;
            } else if (type === 'style') {
                // Update dependent compositions based on realistic/non-realistic style
                updateCompositionPrices();
                updateExtraCharSelectPrices();
                // Ensure composition price updates by re-selecting the current comp
                if (selections.comp) {
                    selections.comp = document.querySelector(`.choice-option[data-type="comp"].selected`)?.dataset.value || 'Headshot';
                }
            } else if (type === 'bg') {
                // Toggle BG slider visibility
                bgSliderGroup.style.display = (value === 'Detailed') ? 'block' : 'none';
                if (value !== 'Detailed') selections.bg_detailed_price = 0; // Reset price if not detailed
            } else if (type === 'extra_pet') {
                const isSelected = this.classList.contains('selected');
                selections.pet_object = isSelected;
                petSliderGroup.style.display = isSelected ? 'block' : 'none';
                if (!isSelected) selections.pet_object_price = 0;
            }

            updateTotalPriceDisplay();
            updateNavigation();
        });
    });

    // Handle Previous Button
    prevBtn.addEventListener('click', () => {
        const prevStep = getPreviousStep(currentStep, selections.medium);
        if (prevStep >= 1) {
            showStep(prevStep, 'prev');
        }
    });

    // Handle Sliders (Detailed BG)
    if (bgSlider) {
        bgSlider.addEventListener('input', function() {
            bgSliderValue.textContent = this.value;
            selections.bg_detailed_price = parseFloat(this.value);
            updateTotalPriceDisplay();
        });
    }

    // Handle Sliders (Pet/Object)
    if (petSlider) {
        petSlider.addEventListener('input', function() {
            petSliderValue.textContent = this.value;
            selections.pet_object_price = parseFloat(this.value);
            updateTotalPriceDisplay();
        });
    }

    // Handle Extra Character Dropdown
    extraCharSelect.addEventListener('change', function() {
        selections.extra_char_type_count = this.value;
        updateTotalPriceDisplay();
        updateNavigation();
    });

    // Handle File Upload Display
    document.querySelector('.file-upload-wrapper').addEventListener('click', () => {
        referenceUpload.click();
    });
    referenceUpload.addEventListener('change', function() {
        if (this.files.length > 0) {
            uploadLabel.textContent = `File selected: ${this.files[0].name}`;
            selections.referenceFile = this.files[0];
        } else {
            uploadLabel.textContent = 'Click here to upload reference file';
            selections.referenceFile = null;
        }
    });
    // Handle Notes Input
    notesInput.addEventListener('input', function() {
        selections.notes = this.value;
    });

    // Handle Copy Details Button (Calls the new function)
    copyDetailsBtn.addEventListener('click', copyDetailsAndShowInstructions);

    // --- Initial Setup ---
    function init() {
        updateNavigation(); // Initial button states
        updateCompositionPrices(); // Set initial composition labels
        updateExtraCharSelectPrices(); // Set initial extra character labels
    }
    
    init();

    </script>
</body>
</html>